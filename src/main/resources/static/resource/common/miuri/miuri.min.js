(function(){var t,r,e,o,n,s,i,p,a,u,h,c={}.hasOwnProperty;h=/^(?:([A-Za-z-+\.]+):\/\/)?(?:(\w+)(?::(\w+))?@)?([^:\/]+)?(?::(\d+))?(\/[^?#]*)?(?:\?([^#]*))?(?:#(.+))?/,u=["protocol","username","password","host","port","path","query","fragment"],s="undefined"!=typeof window&&null!==window?!1:!0,p=function(t){var r,e,o,n,s,i;if(!h.test(t))throw"Invalid uri";for(e=h.exec(t).slice(1),n={},r=s=0,i=u.length;i>s;r=++s)o=u[r],n[o]=e[r];return n},n=function(t){return"[object Array]"===Object.prototype.toString.call(t)},i=function(t){return"[object Object]"===Object.prototype.toString.call(t)},o=function(t,r){var e,o;for(e in r)c.call(r,e)&&(o=r[e],t[e]=o)},a=function(t){var r,e,o,s,p,a,u,h,c,l;for(e=/\[([^\]]*)\]/,r={},c=t.split("&"),u=0,h=c.length;h>u;u++)s=c[u],l=s.split("="),o=l[0],a=l[1],p=e.exec(o),a=decodeURIComponent(a),p?(p[1]&&!i(r[o])?r[o]={}:n(r[o])||(r[o]=[]),p[1]?r[o][p[1]]=a:r[o].push(a)):r[o]=a;return r},e=function(t,r,e){var o,s,p,a;if(null==e&&(e=[]),!n(r)&&!i(r))return""+t+"="+encodeURIComponent(r);if(n(r))for(p=0,a=r.length;a>p;p++)o=r[p],e.push(""+t+"[]="+encodeURIComponent(o));if(i(r))for(s in r)c.call(r,s)&&(o=r[s],e.push(""+t+"["+s+"]="+encodeURIComponent(o)));return e.join("&")},r="/","undefined"!=typeof window&&null!==window&&window.location.host&&(r=window.location.href),t=function(){function t(t){this.uri=null!=t?t:r,this.parts=p(this.uri),this.parts.query=this.parts.query?a(this.parts.query):{},this.parts.path||(this.parts.path="/")}return t.prototype.retrieve=function(t,r){return null==r&&(r=null),null===r?this.parts[t]:(this.parts[t]=r,this)},t.prototype.protocol=function(t){return this.retrieve("protocol",t)},t.prototype.username=function(t){return this.retrieve("username",t)},t.prototype.password=function(t){return this.retrieve("password",t)},t.prototype.host=function(t){return this.retrieve("host",t)},t.prototype.hostname=function(t){return this.host(t)},t.prototype.port=function(t){return this.retrieve("port",t)},t.prototype.path=function(t){return t&&"/"!==t[0]&&(t="/"+t),this.retrieve("path",t)},t.prototype.query=function(t,r){return t&&"string"==typeof t?r?(this.parts.query[t]=r,this):this.parts.query[t]:i(t)?(o(this.parts.query,t),this):this.parts.query},t.prototype.fragment=function(t){return this.retrieve("fragment",t)},t.prototype.pathinfo=function(){var t,r,e,o,n;return n=this.path(),t=n.split("/").pop(),r=n.replace(new RegExp("/?"+t),""),e=/\./.test(t)?t.split(".").pop():"",o=t.replace(new RegExp("\\."+e+"$"),""),""===r&&(r="/"),{path:n,basename:t,dirname:r,extension:e,filename:o}},t.prototype.toString=function(){var t,r,o,n,s;o="",this.parts.protocol&&this.parts.host&&(o+=""+this.parts.protocol+"://",this.parts.username&&this.parts.password?o+=""+this.parts.username+":"+this.parts.password+"@":this.parts.username&&(o+=""+this.parts.username+"@"),o+=this.parts.host,this.parts.port&&(o+=":"+this.parts.port)),o+=this.parts.path,r=[],s=this.parts.query;for(t in s)c.call(s,t)&&(n=s[t],r.push(e(t,n)));return r.length>0&&(o+="?"+r.join("&")),this.parts.fragment&&(o+="#"+this.parts.fragment),o},t}(),s?module.exports=t:this.miuri=t}).call(this);